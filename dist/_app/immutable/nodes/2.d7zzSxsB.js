import{f as _,a as c,c as V}from"../chunks/DqXKHUsY.js";import"../chunks/DybgDApQ.js";import{o as $e,a as Le}from"../chunks/Cqkw32om.js";import{p as Me,t as T,o,g as e,m as Pe,s as d,b as u,q as s,n as p,w as Ue,$ as Re,v as n,x as De,y as W}from"../chunks/DmHJ9QOL.js";import{e as A,s as $}from"../chunks/CaJ6HOFi.js";import{i as L}from"../chunks/CcfVls_4.js";import{h as Ee,e as se,b as Fe,s as re,i as Ne,t as Oe,f as je}from"../chunks/CEQnzM2N.js";import{b as Ie,r as Ke,p as ze}from"../chunks/Cl-7jzWS.js";import{i as Ge}from"../chunks/DPdeReKP.js";import{p as Be}from"../chunks/COVjswXf.js";import{g as He}from"../chunks/0u-JHG7E.js";const Je=!1,Qe=!1,fa=Object.freeze(Object.defineProperty({__proto__:null,prerender:Qe,ssr:Je},Symbol.toStringTag,{value:"Module"}));var Ve=_('<div class="audio-prompt svelte-1uha8ag"><p>Tap anywhere to enable pager sound alerts.</p></div>'),We=_("<option> </option>"),Xe=_('<p class="loading-state svelte-1uha8ag">Loading messages...</p>'),Ye=_('<p class="placeholder-state svelte-1uha8ag">Select a contact to start paging.</p>'),Ze=_('<p class="placeholder-state svelte-1uha8ag">No messages yet. Send a page!</p>'),ea=_('<div><span class="message-content"> </span> <span class="timestamp svelte-1uha8ag"> </span></div>'),aa=_('<p class="error-message"> </p>'),ta=_('<main class="pager-container svelte-1uha8ag"><!> <div class="header svelte-1uha8ag"><h1 class="svelte-1uha8ag">ðŸ“Ÿ Pager King</h1> <div class="user-info svelte-1uha8ag">Logged in as: <strong> </strong> <button class="logout-button svelte-1uha8ag">Logout</button></div></div> <div class="control-group svelte-1uha8ag"><label for="contact-select">Contact:</label> <select id="contact-select" class="svelte-1uha8ag"><option disabled>--- Select Contact ---</option><!></select></div> <div id="msgContainer"><!></div> <form class="send-form svelte-1uha8ag"><input type="text" placeholder="Type your page message..." required class="svelte-1uha8ag"/> <button type="submit" class="svelte-1uha8ag">Send Page</button></form> <!></main>');function ma(ie,X){Me(X,!1);const g=He();let i=Be(X,"data",8)().session?.user??null,f=p([]),h=p([]),r=p(null),O=p("Select Contact"),m=p(""),q=p(!1),b=p(""),x,S=p(!1),j=p(!1),M=!1;$e(()=>{x=new Audio("/beep2.mp3"),x.loop=!0,new Audio().play().then(()=>M=!0).catch(()=>s(j,!0)),oe(),le()}),Le(()=>{g.removeAllChannels(),I()});async function oe(){if(!i)return;s(q,!0);const{data:a,error:t}=await g.from("users").select("id,email").not("id","eq",i.id).limit(10);t?(console.error(t),s(b,"Failed to load contacts")):a&&(s(f,a),e(f).length>0&&(s(r,e(f)[0].id),s(O,e(f)[0].email),Y())),s(q,!1)}async function Y(){if(!i||!e(r)){s(h,[]);return}s(q,!0);const{data:a,error:t}=await g.from("messages").select("*").or(`and(sender_id.eq.${i.id},receiver_id.eq.${e(r)}),and(sender_id.eq.${e(r)},receiver_id.eq.${i.id})`).order("created_at",{ascending:!1}).limit(1);t?(console.error(t),s(b,"Failed to load messages")):s(h,a.reverse()),s(q,!1)}async function ne(){if(!i||!e(r)||e(m).trim()==="")return;const a=e(m).trim();s(m,""),s(b,"");const{data:t,error:l}=await g.from("messages").insert({sender_id:i.id,receiver_id:e(r),text:a}).select().single();if(l){console.error(l),s(b,"Failed to send message"),s(m,a);return}await g.from("messages").delete().or(`and(sender_id.eq.${i.id},receiver_id.eq.${e(r)}),and(sender_id.eq.${e(r)},receiver_id.eq.${i.id})`).not("id","eq",t.id)}function le(){g.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},a=>{const t=a.new;(t.sender_id===i?.id&&t.receiver_id===e(r)||t.sender_id===e(r)&&t.receiver_id===i?.id)&&s(h,[t]),t.receiver_id===i?.id&&de(t.text)}).subscribe()}function de(a){e(S)||!M||(s(S,!0),x.play(),console.log(`PAGER ALERT: ${a}`))}function I(){e(S)&&(s(S,!1),x.pause(),x.currentTime=0)}function ce(){if(M)return;const a=new Audio;a.volume=0,a.play().then(()=>{M=!0,s(j,!1)}).catch(t=>console.error(t))}async function ue(a){await g.from("messages").update({read:!0}).eq("id",a),I()}Ge();var P=ta();Ee("1uha8ag",a=>{Ue(()=>{Re.title="Pager King"})});var Z=o(P);{var ve=a=>{var t=Ve();Oe(3,t,()=>je,()=>({y:-50,duration:500})),c(a,t)};L(Z,a=>{e(j)&&a(ve)})}var K=d(Z,2),ee=d(o(K),2),z=d(o(ee)),pe=o(z,!0);n(z);var ge=d(z,2);n(ee),n(K);var G=d(K,2),U=d(o(G),2);T(()=>{e(r),De(()=>{e(O),e(f)})});var B=o(U);B.value=(B.__value=null)??"";var fe=d(B);se(fe,1,()=>(e(f),u(()=>e(f).filter(a=>a.id!==i?.id))),Ne,(a,t)=>{var l=We(),H=o(l,!0);n(l);var E={};T(()=>{$(H,(e(t),u(()=>e(t).email))),E!==(E=(e(t),u(()=>e(t).id)))&&(l.value=(l.__value=(e(t),u(()=>e(t).id)))??"")}),c(a,l)}),n(U),n(G);var k=d(G,2);let ae;var me=o(k);{var _e=a=>{var t=Xe();c(a,t)},he=a=>{var t=V(),l=W(t);{var H=y=>{var F=Ye();c(y,F)},E=y=>{var F=V(),Ae=W(F);{var qe=w=>{var N=Ze();c(w,N)},xe=w=>{var N=V(),Se=W(N);se(Se,1,()=>e(h),J=>J.id,(J,v)=>{var C=ea(),Q=o(C),ke=o(Q,!0);n(Q);var te=d(Q,2),Ce=o(te,!0);n(te),n(C),T(Te=>{re(C,1,`message-entry ${e(v),u(()=>e(v).sender_id===i?.id?"out":"in")??""}`,"svelte-1uha8ag"),$(ke,(e(v),u(()=>e(v).text))),$(Ce,Te)},[()=>(e(v),u(()=>new Date(e(v).created_at).toLocaleTimeString()))]),A("introend",C,()=>{e(v).receiver_id===i?.id&&!e(v).read&&ue(e(v).id)}),c(J,C)}),c(w,N)};L(Ae,w=>{e(h),u(()=>e(h).length===0)?w(qe):w(xe,!1)},!0)}c(y,F)};L(l,y=>{e(r)?y(E,!1):y(H)},!0)}c(a,t)};L(me,a=>{e(q)?a(_e):a(he,!1)})}n(k);var R=d(k,2),D=o(R);Ke(D);var be=d(D,2);n(R);var ye=d(R,2);{var we=a=>{var t=aa(),l=o(t,!0);n(t),T(()=>$(l,e(b))),c(a,t)};L(ye,a=>{e(b)&&a(we)})}n(P),T(a=>{$(pe,u(()=>i?.email??"Unknown User")),ae=re(k,1,"msg-container svelte-1uha8ag",null,ae,{alerting:e(S)}),D.disabled=!e(r),be.disabled=a},[()=>(e(r),e(m),u(()=>!e(r)||e(m).trim()===""))]),A("click",ge,()=>g.auth.signOut()),Fe(U,()=>e(r),a=>s(r,a)),A("change",U,()=>{s(O,e(f).find(a=>a.id===e(r))?.email||"Select Contact"),Y()}),A("click",k,I),Ie(D,()=>e(m),a=>s(m,a)),A("submit",R,ze(ne)),A("click",P,ce),c(ie,P),Pe()}export{ma as component,fa as universal};
